- name: check frpc exists
  ansible.builtin.stat:
    path: "/root/apps/free-frpc/{{FRP_VERSION}}.version"
  register: basedir_stat
- name: init frpc workspace
  shell: rm -rf /root/apps/free-frpc
  when: not (basedir_stat.stat.exists)
- name: download frpc bin
  shell: |
    mkdir /root/apps/free-frpc -p
    wget -P /root/apps/free-frpc https://ghproxy.com/https://github.com/fatedier/frp/releases/download/v{{FRP_VERSION}}/frp_{{FRP_VERSION}}_linux_amd64.tar.gz -O /root/apps/free-frpc/frpc.tar.gz
  when: not (basedir_stat.stat.exists)
- name: extract frp tar
  shell: tar -xf /root/apps/free-frpc/frpc.tar.gz --strip-components 1 -C /root/apps/free-frpc/
  when: not (basedir_stat.stat.exists)
- name: clean cache
  shell: |
    rm -rf /root/apps/free-frpc/frpc.tar.gz 
    rm -rf /root/apps/free-frpc/frps
    rm -rf /root/apps/free-frpc/frps.ini
    rm -rf /root/apps/free-frpc/frpc_full.ini 
    rm -rf /root/apps/free-frpc/frps_full.ini
    rm -rf /root/apps/free-frpc/frpc.ini